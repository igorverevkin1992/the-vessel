# The Vessel — Smart Blockbuster

CLI-инструмент для создания высокоудерживающего видео-контента по методологии **«Умный блокбастер»** — синтез методов Пэдди Кэллоуэя (алгоритмическое удержание) и Джонни Харриса (визуальная журналистика).

Включает **конвейер ИИ-агентов** (адаптация Chain of Agents из [mediawar.core](https://github.com/igorverevkin1992/mediawar.core-v3.0)).

## Запуск

```bash
# Интерактивное меню
python -m smart_blockbuster

# Конвейер агентов (автоматический режим)
python -m smart_blockbuster --pipeline

# Конвейер агентов (пошаговый режим с ревью)
python -m smart_blockbuster --pipeline --steppable

# Информация о конвейере
python -m smart_blockbuster --agents-info

# Демонстрация
python -m smart_blockbuster --demo

# Анализ JSON-сценария / текста
python -m smart_blockbuster --analyze script.json
python -m smart_blockbuster --text scenario.txt

# Производственный протокол
python -m smart_blockbuster --protocol
```

Python 3.10+ без внешних зависимостей.

## Конвейер агентов (Chain of Agents)

Последовательная цепочка из 5 специализированных агентов, адаптированная из mediawar.core v3.3:

```
Scout → Radar → Analyst → Architect → Writer → [ГОТОВО]
```

| Агент | Роль | Вход | Выход |
|-------|------|------|-------|
| **Скаут (Scout)** | Разведка тем | — | 4 предложения тем с архетипом хука и вирусным фактором |
| **Радар (Radar)** | Вирусные углы | Тема | 3 вирусных угла, дофаминовые крючки, контрарный отскок |
| **Аналитик (Analyst)** | Факт-чекинг | Тема + Радар | Исследовательское досье: утверждения, якоря, петли доказательств |
| **Архитектор (Architect)** | Структура | Досье | Зубчатая дуга, трёхшаговый хук, цепочка But/Therefore |
| **Сценарист (Writer)** | A/V сценарий | Структура + Досье | Двухколоночный сценарий с SFX, музыкой, Pattern Interrupts |

### Режимы работы

- **Автоматический** — агенты выполняются последовательно без пауз
- **Пошаговый (Steppable)** — пауза между агентами для ревью и редактирования

## Инструменты (ручной режим)

### 1. Конструктор Хука (Часть 3)
- **Трёхшаговая формула**: Якорь → Интервенция → Контрарный отскок
- **6 архетипов**: Следователь, Противник, Волшебник, Предсказатель, Экспериментатор, Учитель
- **Чек-лист валидации**: 4 «Всадника Апокалипсиса» (Delay, Confusion, Irrelevance, Disinterest)

### 2. Зубчатая дуга (Часть 4)
- Генерация макро-структуры для видео любой длительности
- 5 фаз: Высокий старт → Контекстный мост → Перезацеп → Расследование → Синтез

### 3. Петли Доказательств (Часть 4)
- Конструктор Evidence Loop: Контекст → Драйвер → Якорь → Раскрытие → Переход
- Анализ принципа **But / Therefore** (золотое правило South Park)

### 4. Анализатор текста (Части 5–7)
- **Стаккато**: проверка длины предложений и рубленого ритма
- **Коннекторы Харриса**: «по сути», «честно говоря», «на самом деле», «посмотрите»
- **Ритм монтажа**: Pattern Interrupts, Visual Stun Gun
- **Звуковой дизайн**: SFX и музыкальные указания

### 5. A/V Сценарий (Часть 8)
- Двухколоночный формат (Аудио | Визуал)
- Экспорт/импорт в JSON
- Полный анализ готового сценария

### 6. Производственный протокол
- 5 этапов: Рисерч → Скелет сюжета → Скриптинг → Съёмка → Пост-продакшн
- Чек-листы для каждого этапа

## Фронтенд (Web UI)

React-приложение в формате [mediawar.core](https://github.com/igorverevkin1992/mediawar.core-v3.0) — тот же стек и паттерн:

- **React 19** + **TypeScript 5.8** + **Tailwind CSS 4** + **Vite 6**
- **useReducer** State Machine для управления конвейером
- **Google Gemini API** (`@google/genai`) для вызова агентов
- Автоматический и пошаговый режимы с редактированием между агентами
- Экспорт: Досье `.doc`, Сценарий `.doc`, Монтаж `.csv`

```bash
npm install
echo "VITE_GEMINI_API_KEY=ваш_ключ" > .env
npm run dev    # http://localhost:3000
```

### Компоненты

| Компонент | Описание |
|-----------|----------|
| `App.tsx` | Главный компонент: state machine, 5 execute-функций, двухколоночный layout |
| `AgentLog` | Терминальный лог с таймстемпами и цветовой индикацией агентов |
| `ScriptDisplay` | Таблица A/V сценария + экспорт в 3 формата |
| `RichTextDisplay` | Рендерер с поддержкой `///` заголовков, `**bold**`, списков |
| `ErrorBoundary` | Перехват ошибок React с кнопкой перезагрузки |

## Структура

```
├── package.json        # React 19, Vite 6, Tailwind 4, @google/genai
├── vite.config.ts      # Конфигурация Vite (порт 3000)
├── tsconfig.json       # TypeScript конфигурация
├── index.html          # HTML-оболочка фронтенда
│
├── src/                           # React Web UI
│   ├── index.tsx       # Точка входа React
│   ├── index.css       # Tailwind + кастомная тёмная тема (sb-*)
│   ├── App.tsx         # Главный компонент (State Machine + Pipeline)
│   ├── types.ts        # TypeScript типы (зеркало Python моделей)
│   ├── constants.ts    # Промпты агентов, модели, конфигурация
│   └── components/
│       ├── AgentLog.tsx        # Терминальный лог
│       ├── ScriptDisplay.tsx   # Таблица A/V сценария
│       ├── RichTextDisplay.tsx # Рендерер текста
│       └── ErrorBoundary.tsx   # Перехват ошибок
│
└── smart_blockbuster/             # Python CLI
    ├── __init__.py     # Пакет
    ├── __main__.py     # Точка входа (python -m)
    ├── main.py         # CLI и интерактивное меню
    ├── models.py       # Модели данных (Дофаминовая лестница, архетипы, фазы)
    ├── agent_types.py  # Типы агентов, состояния конвейера (из mediawar.core)
    ├── agents.py       # 5 агентов: Scout, Radar, Analyst, Architect, Writer
    ├── orchestrator.py # Оркестратор цепочки агентов (State Machine + Pipeline)
    ├── hook_engine.py  # Движок хуков: конструктор + валидация
    ├── structure.py    # Зубчатая дуга, Петли доказательств, But/Therefore
    ├── analyzer.py     # Анализ текста: Стаккато, коннекторы, ритм, звук
    └── production.py   # Производственный протокол, A/V сценарий, экспорт
```

## Методология

Основано на документе **«Архитектура Умного блокбастера: Операционный мануал по синтезу методологий Кэллоуэя и Харриса»**. Архитектура агентов адаптирована из **[mediawar.core v3.3](https://github.com/igorverevkin1992/mediawar.core-v3.0)**.
